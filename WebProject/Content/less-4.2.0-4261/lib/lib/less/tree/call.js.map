{"version":3,"file":"call.js","sourceRoot":"","sources":["../../../less/tree/call.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar node_1 = tslib_1.__importDefault(require(\"./node\"));\r\nvar anonymous_1 = tslib_1.__importDefault(require(\"./anonymous\"));\r\nvar function_caller_1 = tslib_1.__importDefault(require(\"../functions/function-caller\"));\r\n//\r\n// A function call node.\r\n//\r\nvar Call = function (name, args, index, currentFileInfo) {\r\n    this.name = name;\r\n    this.args = args;\r\n    this.calc = name === 'calc';\r\n    this._index = index;\r\n    this._fileInfo = currentFileInfo;\r\n};\r\nCall.prototype = Object.assign(new node_1.default(), {\r\n    type: 'Call',\r\n    accept: function (visitor) {\r\n        if (this.args) {\r\n            this.args = visitor.visitArray(this.args);\r\n        }\r\n    },\r\n    //\r\n    // When evaluating a function call,\r\n    // we either find the function in the functionRegistry,\r\n    // in which case we call it, passing the  evaluated arguments,\r\n    // if this returns null or we cannot find the function, we\r\n    // simply print it out as it appeared originally [2].\r\n    //\r\n    // The reason why we evaluate the arguments, is in the case where\r\n    // we try to pass a variable to a function, like: `saturate(@color)`.\r\n    // The function should receive the value, not the variable.\r\n    //\r\n    eval: function (context) {\r\n        var _this = this;\r\n        /**\r\n         * Turn off math for calc(), and switch back on for evaluating nested functions\r\n         */\r\n        var currentMathContext = context.mathOn;\r\n        context.mathOn = !this.calc;\r\n        if (this.calc || context.inCalc) {\r\n            context.enterCalc();\r\n        }\r\n        var exitCalc = function () {\r\n            if (_this.calc || context.inCalc) {\r\n                context.exitCalc();\r\n            }\r\n            context.mathOn = currentMathContext;\r\n        };\r\n        var result;\r\n        var funcCaller = new function_caller_1.default(this.name, context, this.getIndex(), this.fileInfo());\r\n        if (funcCaller.isValid()) {\r\n            try {\r\n                result = funcCaller.call(this.args);\r\n                exitCalc();\r\n            }\r\n            catch (e) {\r\n                // eslint-disable-next-line no-prototype-builtins\r\n                if (e.hasOwnProperty('line') && e.hasOwnProperty('column')) {\r\n                    throw e;\r\n                }\r\n                throw {\r\n                    type: e.type || 'Runtime',\r\n                    message: \"Error evaluating function `\".concat(this.name, \"`\").concat(e.message ? \": \".concat(e.message) : ''),\r\n                    index: this.getIndex(),\r\n                    filename: this.fileInfo().filename,\r\n                    line: e.lineNumber,\r\n                    column: e.columnNumber\r\n                };\r\n            }\r\n        }\r\n        if (result !== null && result !== undefined) {\r\n            // Results that that are not nodes are cast as Anonymous nodes\r\n            // Falsy values or booleans are returned as empty nodes\r\n            if (!(result instanceof node_1.default)) {\r\n                if (!result || result === true) {\r\n                    result = new anonymous_1.default(null);\r\n                }\r\n                else {\r\n                    result = new anonymous_1.default(result.toString());\r\n                }\r\n            }\r\n            result._index = this._index;\r\n            result._fileInfo = this._fileInfo;\r\n            return result;\r\n        }\r\n        var args = this.args.map(function (a) { return a.eval(context); });\r\n        exitCalc();\r\n        return new Call(this.name, args, this.getIndex(), this.fileInfo());\r\n    },\r\n    genCSS: function (context, output) {\r\n        output.add(\"\".concat(this.name, \"(\"), this.fileInfo(), this.getIndex());\r\n        for (var i = 0; i < this.args.length; i++) {\r\n            this.args[i].genCSS(context, output);\r\n            if (i + 1 < this.args.length) {\r\n                output.add(', ');\r\n            }\r\n        }\r\n        output.add(')');\r\n    }\r\n});\r\nexports.default = Call;\r\n//# sourceMappingURL=call.js.map"]}