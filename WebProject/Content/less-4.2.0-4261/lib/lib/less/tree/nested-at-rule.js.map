{"version":3,"file":"nested-at-rule.js","sourceRoot":"","sources":["../../../less/tree/nested-at-rule.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar ruleset_1 = tslib_1.__importDefault(require(\"./ruleset\"));\r\nvar value_1 = tslib_1.__importDefault(require(\"./value\"));\r\nvar selector_1 = tslib_1.__importDefault(require(\"./selector\"));\r\nvar anonymous_1 = tslib_1.__importDefault(require(\"./anonymous\"));\r\nvar expression_1 = tslib_1.__importDefault(require(\"./expression\"));\r\nvar utils = tslib_1.__importStar(require(\"../utils\"));\r\nvar NestableAtRulePrototype = {\r\n    isRulesetLike: function () {\r\n        return true;\r\n    },\r\n    accept: function (visitor) {\r\n        if (this.features) {\r\n            this.features = visitor.visit(this.features);\r\n        }\r\n        if (this.rules) {\r\n            this.rules = visitor.visitArray(this.rules);\r\n        }\r\n    },\r\n    evalTop: function (context) {\r\n        var result = this;\r\n        // Render all dependent Media blocks.\r\n        if (context.mediaBlocks.length > 1) {\r\n            var selectors = (new selector_1.default([], null, null, this.getIndex(), this.fileInfo())).createEmptySelectors();\r\n            result = new ruleset_1.default(selectors, context.mediaBlocks);\r\n            result.multiMedia = true;\r\n            result.copyVisibilityInfo(this.visibilityInfo());\r\n            this.setParent(result, this);\r\n        }\r\n        delete context.mediaBlocks;\r\n        delete context.mediaPath;\r\n        return result;\r\n    },\r\n    evalNested: function (context) {\r\n        var i;\r\n        var value;\r\n        var path = context.mediaPath.concat([this]);\r\n        // Extract the media-query conditions separated with `,` (OR).\r\n        for (i = 0; i < path.length; i++) {\r\n            value = path[i].features instanceof value_1.default ?\r\n                path[i].features.value : path[i].features;\r\n            path[i] = Array.isArray(value) ? value : [value];\r\n        }\r\n        // Trace all permutations to generate the resulting media-query.\r\n        //\r\n        // (a, b and c) with nested (d, e) ->\r\n        //    a and d\r\n        //    a and e\r\n        //    b and c and d\r\n        //    b and c and e\r\n        this.features = new value_1.default(this.permute(path).map(function (path) {\r\n            path = path.map(function (fragment) { return fragment.toCSS ? fragment : new anonymous_1.default(fragment); });\r\n            for (i = path.length - 1; i > 0; i--) {\r\n                path.splice(i, 0, new anonymous_1.default('and'));\r\n            }\r\n            return new expression_1.default(path);\r\n        }));\r\n        this.setParent(this.features, this);\r\n        // Fake a tree-node that doesn't output anything.\r\n        return new ruleset_1.default([], []);\r\n    },\r\n    permute: function (arr) {\r\n        if (arr.length === 0) {\r\n            return [];\r\n        }\r\n        else if (arr.length === 1) {\r\n            return arr[0];\r\n        }\r\n        else {\r\n            var result = [];\r\n            var rest = this.permute(arr.slice(1));\r\n            for (var i = 0; i < rest.length; i++) {\r\n                for (var j = 0; j < arr[0].length; j++) {\r\n                    result.push([arr[0][j]].concat(rest[i]));\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n    },\r\n    bubbleSelectors: function (selectors) {\r\n        if (!selectors) {\r\n            return;\r\n        }\r\n        this.rules = [new ruleset_1.default(utils.copyArray(selectors), [this.rules[0]])];\r\n        this.setParent(this.rules, this);\r\n    }\r\n};\r\nexports.default = NestableAtRulePrototype;\r\n//# sourceMappingURL=nested-at-rule.js.map"]}