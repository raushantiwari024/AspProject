{"version":3,"file":"dimension.js","sourceRoot":"","sources":["../../../less/tree/dimension.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\n/* eslint-disable no-prototype-builtins */\r\nvar node_1 = tslib_1.__importDefault(require(\"./node\"));\r\nvar unit_conversions_1 = tslib_1.__importDefault(require(\"../data/unit-conversions\"));\r\nvar unit_1 = tslib_1.__importDefault(require(\"./unit\"));\r\nvar color_1 = tslib_1.__importDefault(require(\"./color\"));\r\n//\r\n// A number with a unit\r\n//\r\nvar Dimension = function (value, unit) {\r\n    this.value = parseFloat(value);\r\n    if (isNaN(this.value)) {\r\n        throw new Error('Dimension is not a number.');\r\n    }\r\n    this.unit = (unit && unit instanceof unit_1.default) ? unit :\r\n        new unit_1.default(unit ? [unit] : undefined);\r\n    this.setParent(this.unit, this);\r\n};\r\nDimension.prototype = Object.assign(new node_1.default(), {\r\n    type: 'Dimension',\r\n    accept: function (visitor) {\r\n        this.unit = visitor.visit(this.unit);\r\n    },\r\n    // remove when Nodes have JSDoc types\r\n    // eslint-disable-next-line no-unused-vars\r\n    eval: function (context) {\r\n        return this;\r\n    },\r\n    toColor: function () {\r\n        return new color_1.default([this.value, this.value, this.value]);\r\n    },\r\n    genCSS: function (context, output) {\r\n        if ((context && context.strictUnits) && !this.unit.isSingular()) {\r\n            throw new Error(\"Multiple units in dimension. Correct the units or use the unit function. Bad unit: \".concat(this.unit.toString()));\r\n        }\r\n        var value = this.fround(context, this.value);\r\n        var strValue = String(value);\r\n        if (value !== 0 && value < 0.000001 && value > -0.000001) {\r\n            // would be output 1e-6 etc.\r\n            strValue = value.toFixed(20).replace(/0+$/, '');\r\n        }\r\n        if (context && context.compress) {\r\n            // Zero values doesn't need a unit\r\n            if (value === 0 && this.unit.isLength()) {\r\n                output.add(strValue);\r\n                return;\r\n            }\r\n            // Float values doesn't need a leading zero\r\n            if (value > 0 && value < 1) {\r\n                strValue = (strValue).substr(1);\r\n            }\r\n        }\r\n        output.add(strValue);\r\n        this.unit.genCSS(context, output);\r\n    },\r\n    // In an operation between two Dimensions,\r\n    // we default to the first Dimension's unit,\r\n    // so `1px + 2` will yield `3px`.\r\n    operate: function (context, op, other) {\r\n        /* jshint noempty:false */\r\n        var value = this._operate(context, op, this.value, other.value);\r\n        var unit = this.unit.clone();\r\n        if (op === '+' || op === '-') {\r\n            if (unit.numerator.length === 0 && unit.denominator.length === 0) {\r\n                unit = other.unit.clone();\r\n                if (this.unit.backupUnit) {\r\n                    unit.backupUnit = this.unit.backupUnit;\r\n                }\r\n            }\r\n            else if (other.unit.numerator.length === 0 && unit.denominator.length === 0) {\r\n                // do nothing\r\n            }\r\n            else {\r\n                other = other.convertTo(this.unit.usedUnits());\r\n                if (context.strictUnits && other.unit.toString() !== unit.toString()) {\r\n                    throw new Error('Incompatible units. Change the units or use the unit function. '\r\n                        + \"Bad units: '\".concat(unit.toString(), \"' and '\").concat(other.unit.toString(), \"'.\"));\r\n                }\r\n                value = this._operate(context, op, this.value, other.value);\r\n            }\r\n        }\r\n        else if (op === '*') {\r\n            unit.numerator = unit.numerator.concat(other.unit.numerator).sort();\r\n            unit.denominator = unit.denominator.concat(other.unit.denominator).sort();\r\n            unit.cancel();\r\n        }\r\n        else if (op === '/') {\r\n            unit.numerator = unit.numerator.concat(other.unit.denominator).sort();\r\n            unit.denominator = unit.denominator.concat(other.unit.numerator).sort();\r\n            unit.cancel();\r\n        }\r\n        return new Dimension(value, unit);\r\n    },\r\n    compare: function (other) {\r\n        var a, b;\r\n        if (!(other instanceof Dimension)) {\r\n            return undefined;\r\n        }\r\n        if (this.unit.isEmpty() || other.unit.isEmpty()) {\r\n            a = this;\r\n            b = other;\r\n        }\r\n        else {\r\n            a = this.unify();\r\n            b = other.unify();\r\n            if (a.unit.compare(b.unit) !== 0) {\r\n                return undefined;\r\n            }\r\n        }\r\n        return node_1.default.numericCompare(a.value, b.value);\r\n    },\r\n    unify: function () {\r\n        return this.convertTo({ length: 'px', duration: 's', angle: 'rad' });\r\n    },\r\n    convertTo: function (conversions) {\r\n        var value = this.value;\r\n        var unit = this.unit.clone();\r\n        var i;\r\n        var groupName;\r\n        var group;\r\n        var targetUnit;\r\n        var derivedConversions = {};\r\n        var applyUnit;\r\n        if (typeof conversions === 'string') {\r\n            for (i in unit_conversions_1.default) {\r\n                if (unit_conversions_1.default[i].hasOwnProperty(conversions)) {\r\n                    derivedConversions = {};\r\n                    derivedConversions[i] = conversions;\r\n                }\r\n            }\r\n            conversions = derivedConversions;\r\n        }\r\n        applyUnit = function (atomicUnit, denominator) {\r\n            if (group.hasOwnProperty(atomicUnit)) {\r\n                if (denominator) {\r\n                    value = value / (group[atomicUnit] / group[targetUnit]);\r\n                }\r\n                else {\r\n                    value = value * (group[atomicUnit] / group[targetUnit]);\r\n                }\r\n                return targetUnit;\r\n            }\r\n            return atomicUnit;\r\n        };\r\n        for (groupName in conversions) {\r\n            if (conversions.hasOwnProperty(groupName)) {\r\n                targetUnit = conversions[groupName];\r\n                group = unit_conversions_1.default[groupName];\r\n                unit.map(applyUnit);\r\n            }\r\n        }\r\n        unit.cancel();\r\n        return new Dimension(value, unit);\r\n    }\r\n});\r\nexports.default = Dimension;\r\n//# sourceMappingURL=dimension.js.map"]}