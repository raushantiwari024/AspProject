{"version":3,"file":"visitor.js","sourceRoot":"","sources":["../../../less/visitors/visitor.js"],"names":[],"mappings":"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","sourcesContent":["\"use strict\";\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar tslib_1 = require(\"tslib\");\r\nvar tree_1 = tslib_1.__importDefault(require(\"../tree\"));\r\nvar _visitArgs = { visitDeeper: true };\r\nvar _hasIndexed = false;\r\nfunction _noop(node) {\r\n    return node;\r\n}\r\nfunction indexNodeTypes(parent, ticker) {\r\n    // add .typeIndex to tree node types for lookup table\r\n    var key, child;\r\n    for (key in parent) {\r\n        /* eslint guard-for-in: 0 */\r\n        child = parent[key];\r\n        switch (typeof child) {\r\n            case 'function':\r\n                // ignore bound functions directly on tree which do not have a prototype\r\n                // or aren't nodes\r\n                if (child.prototype && child.prototype.type) {\r\n                    child.prototype.typeIndex = ticker++;\r\n                }\r\n                break;\r\n            case 'object':\r\n                ticker = indexNodeTypes(child, ticker);\r\n                break;\r\n        }\r\n    }\r\n    return ticker;\r\n}\r\nvar Visitor = /** @class */ (function () {\r\n    function Visitor(implementation) {\r\n        this._implementation = implementation;\r\n        this._visitInCache = {};\r\n        this._visitOutCache = {};\r\n        if (!_hasIndexed) {\r\n            indexNodeTypes(tree_1.default, 1);\r\n            _hasIndexed = true;\r\n        }\r\n    }\r\n    Visitor.prototype.visit = function (node) {\r\n        if (!node) {\r\n            return node;\r\n        }\r\n        var nodeTypeIndex = node.typeIndex;\r\n        if (!nodeTypeIndex) {\r\n            // MixinCall args aren't a node type?\r\n            if (node.value && node.value.typeIndex) {\r\n                this.visit(node.value);\r\n            }\r\n            return node;\r\n        }\r\n        var impl = this._implementation;\r\n        var func = this._visitInCache[nodeTypeIndex];\r\n        var funcOut = this._visitOutCache[nodeTypeIndex];\r\n        var visitArgs = _visitArgs;\r\n        var fnName;\r\n        visitArgs.visitDeeper = true;\r\n        if (!func) {\r\n            fnName = \"visit\".concat(node.type);\r\n            func = impl[fnName] || _noop;\r\n            funcOut = impl[\"\".concat(fnName, \"Out\")] || _noop;\r\n            this._visitInCache[nodeTypeIndex] = func;\r\n            this._visitOutCache[nodeTypeIndex] = funcOut;\r\n        }\r\n        if (func !== _noop) {\r\n            var newNode = func.call(impl, node, visitArgs);\r\n            if (node && impl.isReplacing) {\r\n                node = newNode;\r\n            }\r\n        }\r\n        if (visitArgs.visitDeeper && node) {\r\n            if (node.length) {\r\n                for (var i = 0, cnt = node.length; i < cnt; i++) {\r\n                    if (node[i].accept) {\r\n                        node[i].accept(this);\r\n                    }\r\n                }\r\n            }\r\n            else if (node.accept) {\r\n                node.accept(this);\r\n            }\r\n        }\r\n        if (funcOut != _noop) {\r\n            funcOut.call(impl, node);\r\n        }\r\n        return node;\r\n    };\r\n    Visitor.prototype.visitArray = function (nodes, nonReplacing) {\r\n        if (!nodes) {\r\n            return nodes;\r\n        }\r\n        var cnt = nodes.length;\r\n        var i;\r\n        // Non-replacing\r\n        if (nonReplacing || !this._implementation.isReplacing) {\r\n            for (i = 0; i < cnt; i++) {\r\n                this.visit(nodes[i]);\r\n            }\r\n            return nodes;\r\n        }\r\n        // Replacing\r\n        var out = [];\r\n        for (i = 0; i < cnt; i++) {\r\n            var evald = this.visit(nodes[i]);\r\n            if (evald === undefined) {\r\n                continue;\r\n            }\r\n            if (!evald.splice) {\r\n                out.push(evald);\r\n            }\r\n            else if (evald.length) {\r\n                this.flatten(evald, out);\r\n            }\r\n        }\r\n        return out;\r\n    };\r\n    Visitor.prototype.flatten = function (arr, out) {\r\n        if (!out) {\r\n            out = [];\r\n        }\r\n        var cnt, i, item, nestedCnt, j, nestedItem;\r\n        for (i = 0, cnt = arr.length; i < cnt; i++) {\r\n            item = arr[i];\r\n            if (item === undefined) {\r\n                continue;\r\n            }\r\n            if (!item.splice) {\r\n                out.push(item);\r\n                continue;\r\n            }\r\n            for (j = 0, nestedCnt = item.length; j < nestedCnt; j++) {\r\n                nestedItem = item[j];\r\n                if (nestedItem === undefined) {\r\n                    continue;\r\n                }\r\n                if (!nestedItem.splice) {\r\n                    out.push(nestedItem);\r\n                }\r\n                else if (nestedItem.length) {\r\n                    this.flatten(nestedItem, out);\r\n                }\r\n            }\r\n        }\r\n        return out;\r\n    };\r\n    return Visitor;\r\n}());\r\nexports.default = Visitor;\r\n//# sourceMappingURL=visitor.js.map"]}