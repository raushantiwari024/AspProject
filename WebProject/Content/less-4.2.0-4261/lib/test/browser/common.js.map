{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../test/browser/common.js"],"names":[],"mappings":"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","sourcesContent":["var logMessages = [];\nwindow.less = window.less || {};\n\nvar logLevel_debug = 4,\n    logLevel_info = 3,\n    logLevel_warn = 2,\n    logLevel_error = 1;\n\n// The amount of logging in the javascript console.\n// 3 - Debug, information and errors\n// 2 - Information and errors\n// 1 - Errors\n// 0 - None\n// Defaults to 2\n\nless.loggers = [\n    {\n        debug: function(msg) {\n            if (less.options.logLevel >= logLevel_debug) {\n                logMessages.push(msg);\n            }\n        },\n        info: function(msg) {\n            if (less.options.logLevel >= logLevel_info) {\n                logMessages.push(msg);\n            }\n        },\n        warn: function(msg) {\n            if (less.options.logLevel >= logLevel_warn) {\n                logMessages.push(msg);\n            }\n        },\n        error: function(msg) {\n            if (less.options.logLevel >= logLevel_error) {\n                logMessages.push(msg);\n            }\n        }\n    }\n];\n\ntestLessEqualsInDocument = function () {\n    testLessInDocument(testSheet);\n};\n\ntestLessErrorsInDocument = function (isConsole) {\n    testLessInDocument(isConsole ? testErrorSheetConsole : testErrorSheet);\n};\n\ntestLessInDocument = function (testFunc) {\n    var links = document.getElementsByTagName('link'),\n        typePattern = /^text\\/(x-)?less$/;\n\n    for (var i = 0; i < links.length; i++) {\n        if (links[i].rel === 'stylesheet/less' || (links[i].rel.match(/stylesheet/) &&\n            (links[i].type.match(typePattern)))) {\n            testFunc(links[i]);\n        }\n    }\n};\n\nieFormat = function(text) {\n    var styleNode = document.createElement('style');\n    styleNode.setAttribute('type', 'text/css');\n    var headNode = document.getElementsByTagName('head')[0];\n    headNode.appendChild(styleNode);\n    try {\n        if (styleNode.styleSheet) {\n            styleNode.styleSheet.cssText = text;\n        } else {\n            styleNode.innerText = text;\n        }\n    } catch (e) {\n        throw new Error('Couldn\\'t reassign styleSheet.cssText.');\n    }\n    var transformedText = styleNode.styleSheet ? styleNode.styleSheet.cssText : styleNode.innerText;\n    headNode.removeChild(styleNode);\n    return transformedText;\n};\n\ntestSheet = function (sheet) {\n    it(sheet.id + ' should match the expected output', function (done) {\n        var lessOutputId = sheet.id.replace('original-', ''),\n            expectedOutputId = 'expected-' + lessOutputId,\n            lessOutputObj,\n            lessOutput,\n            expectedOutputHref = document.getElementById(expectedOutputId).href,\n            expectedOutput = loadFile(expectedOutputHref);\n\n        // Browser spec generates less on the fly, so we need to loose control\n        less.pageLoadFinished\n            .then(function () {\n                lessOutputObj = document.getElementById(lessOutputId);\n                lessOutput = lessOutputObj.styleSheet ? lessOutputObj.styleSheet.cssText :\n                    (lessOutputObj.innerText || lessOutputObj.innerHTML);\n\n                expectedOutput\n                    .then(function (text) {\n                        if (window.navigator.userAgent.indexOf('MSIE') >= 0 ||\n                            window.navigator.userAgent.indexOf('Trident/') >= 0) {\n                            text = ieFormat(text);\n                        }\n                        expect(lessOutput).to.equal(text);\n                        done();\n                    })\n                    .catch(function(err) {\n                        done(err);\n                    });\n            })\n            .catch(function(err) {\n                done(err);\n            });\n    });\n};\n\n// TODO: do it cleaner - the same way as in css\n\nfunction extractId(href) {\n    return href.replace(/^[a-z-]+:\\/+?[^\\/]+/i, '') // Remove protocol & domain\n        .replace(/^\\//, '') // Remove root /\n        .replace(/\\.[a-zA-Z]+$/, '') // Remove simple extension\n        .replace(/[^\\.\\w-]+/g, '-') // Replace illegal characters\n        .replace(/\\./g, ':'); // Replace dots with colons(for valid id)\n}\n\nwaitFor = function (waitFunc) {\n    return new Promise(function (resolve) {\n        var timeoutId = setInterval(function () {\n            if (waitFunc()) {\n                clearInterval(timeoutId);\n                resolve();\n            }\n        }, 5);\n    });\n};\n\ntestErrorSheet = function (sheet) {\n    it(sheet.id + ' should match an error', function (done) {\n        var lessHref = sheet.href,\n            id = 'less-error-message:' + extractId(lessHref),\n            errorHref = lessHref.replace(/.less$/, '.txt'),\n            errorFile = loadFile(errorHref),\n            actualErrorElement,\n            actualErrorMsg;\n\n        // Less.js sets 10ms timer in order to add error message on top of page.\n        waitFor(function () {\n            actualErrorElement = document.getElementById(id);\n            return actualErrorElement !== null;\n        }).then(function () {\n            var innerText = (actualErrorElement.innerHTML\n                .replace(/<h3>|<\\/?p>|<a href=\"[^\"]*\">|<\\/a>|<ul>|<\\/?pre( class=\"?[^\">]*\"?)?>|<\\/li>|<\\/?label>/ig, '')\n                .replace(/<\\/h3>/ig, ' ')\n                .replace(/<li>|<\\/ul>|<br>/ig, '\\n'))\n                .replace(/&amp;/ig, '&')\n            // for IE8\n                .replace(/\\r\\n/g, '\\n')\n                .replace(/\\. \\nin/, '. in');\n            actualErrorMsg = innerText\n                .replace(/\\n\\d+/g, function (lineNo) {\n                    return lineNo + ' ';\n                })\n                .replace(/\\n\\s*in /g, ' in ')\n                .replace(/\\n{2,}/g, '\\n')\n                .replace(/\\nStack Trace\\n[\\s\\S]*/i, '')\n                .replace(/\\n$/, '')\n                .trim();\n            errorFile\n                .then(function (errorTxt) {\n                    errorTxt = errorTxt\n                        .replace(/\\{path\\}/g, '')\n                        .replace(/\\{pathrel\\}/g, '')\n                        .replace(/\\{pathhref\\}/g, 'http://localhost:8081/test/less/errors/')\n                        .replace(/\\{404status\\}/g, ' (404)')\n                        .replace(/\\{node\\}[\\s\\S]*\\{\\/node\\}/g, '')\n                        .replace(/\\n$/, '')\n                        .trim();\n                    expect(actualErrorMsg).to.equal(errorTxt);\n                    if (errorTxt == actualErrorMsg) {\n                        actualErrorElement.style.display = 'none';\n                    }\n                    done();\n                })\n                .catch(function (err) {\n                    done(err);\n                });\n        });\n    });\n};\n\ntestErrorSheetConsole = function (sheet) {\n    it(sheet.id + ' should match an error', function (done) {\n        var lessHref = sheet.href,\n            id = sheet.id.replace(/^original-less:/, 'less-error-message:'),\n            errorHref = lessHref.replace(/.less$/, '.txt'),\n            errorFile = loadFile(errorHref),\n            actualErrorElement = document.getElementById(id),\n            actualErrorMsg = logMessages[logMessages.length - 1]\n                .replace(/\\nStack Trace\\n[\\s\\S]*/, '');\n\n        describe('the error', function () {\n            expect(actualErrorElement).to.be.null;\n        });\n\n        errorFile\n            .then(function (errorTxt) {\n                errorTxt\n                    .replace(/\\{path\\}/g, '')\n                    .replace(/\\{pathrel\\}/g, '')\n                    .replace(/\\{pathhref\\}/g, 'http://localhost:8081/browser/less/')\n                    .replace(/\\{404status\\}/g, ' (404)')\n                    .replace(/\\{node\\}.*\\{\\/node\\}/g, '')\n                    .trim();\n                expect(actualErrorMsg).to.equal(errorTxt);\n                done();\n            });\n    });\n};\n\nloadFile = function (href) {\n    return new Promise(function (resolve, reject) {\n        var request = new XMLHttpRequest();\n        request.open('GET', href, true);\n        request.onreadystatechange = function () {\n            if (request.readyState == 4) {\n                resolve(request.responseText.replace(/\\r/g, ''));\n            }\n        };\n        request.send(null);\n    });\n};\n"]}