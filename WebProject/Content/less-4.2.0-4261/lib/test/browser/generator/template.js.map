{"version":3,"file":"template.js","sourceRoot":"","sources":["../../../../test/browser/generator/template.js"],"names":[],"mappings":";AAAA,IAAM,IAAI,GAAG,OAAO,CAAC,mBAAmB,CAAC,CAAA;AACzC,IAAM,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,CAAA;AACpB,IAAA,wBAAwB,GAAK,OAAO,CAAC,SAAS,CAAC,yBAAvB,CAAuB;AAEvD,IAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,iBAAiB,CAAC,CAAC;AAC3D,IAAM,QAAQ,GAAG,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAA;AACzG,IAAM,OAAO,GAAG,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAA;AACvG,IAAM,gBAAgB,GAAG,wBAAwB,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,yBAAyB,CAAC,CAAC,CAAC,CAAC,CAAA;AAEnI;;GAEG;AACH,MAAM,CAAC,OAAO,GAAG,UAAC,WAAW,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI;IAC9C,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,EAAE,CAAC;QAC1B,OAAO,GAAG,CAAC,OAAO,CAAC,CAAA;IACvB,CAAC;IACD,OAAO,IAAI,otDAAA,6LASR,EAWU,WAEV,EAEQ,2CAEqB,EAAQ,2GAMxB,EAAQ,4CACR,EAAgB,sDAChB,EAAO,2OASF,EAAI,kCACV,EAAqB,o9BA+BvC,IAlEM,WAAW,CAAC,GAAG,CAAC,UAAS,YAAY;QACpC,IAAI,SAAS,GAAG,YAAY,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACxC,IAAI,WAAW,GAAG,YAAY;aACzB,OAAO,CAAC,gCAAgC,EAAE,UAAU,CAAC;aACrD,OAAO,CAAC,OAAO,EAAE,KAAK,CAAC,CAAA;QAC5B,IAAI,QAAQ,GAAG,SAAS,CAAC,SAAS,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;QAC/C,IAAI,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAClC,OAAO,0FAEyB,IAAI,kCAAsB,IAAI,kEAAkD,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,YAAY,CAAC,yDACpH,IAAI,6DAA6C,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,WAAW,CAAC,cACvH,CAAA;IAAC,CAAC,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAEV,OAAO,CAAC,GAAG,CAAC,UAAA,MAAM,IAAI,OAAA,wCACA,MAAM,uBAC9B,EAFwB,CAExB,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,EAEqB,QAAQ,EAMxB,QAAQ,EACR,gBAAgB,EAChB,OAAO,EASF,IAAI,EACV,IAAI,IAAI,aAAa,EA+BvC;AACD,CAAC,CAAA","sourcesContent":["const html = require('html-template-tag')\nconst path = require('path')\nconst { forceCovertToBrowserPath } = require('./utils')\n\nconst webRoot = path.resolve(__dirname, '../../../../../');\nconst mochaDir = forceCovertToBrowserPath(path.relative(webRoot, path.dirname(require.resolve('mocha'))))\nconst chaiDir = forceCovertToBrowserPath(path.relative(webRoot, path.dirname(require.resolve('chai'))))\nconst mochaTeamCityDir = forceCovertToBrowserPath(path.relative(webRoot, path.dirname(require.resolve('mocha-teamcity-reporter'))))\n\n/**\n * Generates HTML templates from list of test sheets\n */\nmodule.exports = (stylesheets, helpers, spec, less) => {\n    if (!Array.isArray(helpers)) {\n        helpers = [helpers]\n    }\n    return html`\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\">\n    \n    <title>Less.js Spec Runner</title>\n\n    <!-- for each test, generate CSS/LESS link tags -->\n    $${stylesheets.map(function(fullLessName) {\n        var pathParts = fullLessName.split('/');\n        var fullCssName = fullLessName\n            .replace(/\\/(browser|test-data)\\/less\\//g, '/$1/css/')\n            .replace(/less$/, 'css')\n        var lessName = pathParts[pathParts.length - 1];\n        var name = lessName.split('.')[0];\n        return `\n    <!-- the tags to be generated -->\n    <link id=\"original-less:test-less-${name}\" title=\"test-less-${name}\" rel=\"stylesheet/less\" type=\"text/css\" href=\"/${path.relative(webRoot, fullLessName)}\">\n    <link id=\"expected-less:test-less-${name}\" rel=\"stylesheet\" type=\"text/css\" href=\"/${path.relative(webRoot, fullCssName)}\">\n    ` }).join('')}\n\n    $${helpers.map(helper => `\n        <script src=\"../../${helper}\"></script>\n    `).join('')}\n\n    <link rel=\"stylesheet\" href=\"/${mochaDir}/mocha.css\">\n</head>\n\n<body>\n    <!-- content -->\n    <div id=\"mocha\"></div>\n    <script src=\"/${mochaDir}/mocha.js\"></script>\n    <script src=\"/${mochaTeamCityDir}/teamcityBrowser.js\"></script>\n    <script src=\"/${chaiDir}/chai.js\"></script>\n    <script>\n        expect = chai.expect\n        mocha.setup({\n            ui: 'bdd',\n            timeout: 2500\n        });\n    </script>\n    <script src=\"common.js\"></script>\n    <script src=\"../../${spec}\"></script>\n    <script src=\"${less || 'less.min.js'}\"></script>\n    <script>\n        /** Saucelabs config */\n        onload = function() {\n            var runner = mocha.run();\n\n            var failedTests = [];\n            runner.on('end', function() {\n                window.mochaResults = runner.stats;\n                window.mochaResults.reports = failedTests;\n            });\n\n            runner.on('fail', logFailure);\n\n            function logFailure(test, err){\n                var flattenTitles = function(test){\n                    var titles = [];\n                    while (test.parent.title) {\n                        titles.push(test.parent.title);\n                        test = test.parent;\n                    }\n                    return titles.reverse();\n                };\n\n                failedTests.push({name: test.title, result: false, message: err.message, stack: err.stack, titles: flattenTitles(test) });\n            };\n        };\n        \n    </script>\n</body>\n</html>\n`\n}"]}